# 新版认证说明

## 重要更新

由于录播平台 API 更新，现在需要用户提供身份验证信息才能下载视频。

## 如何获取认证信息

### 方式一（推荐）：账号密码一键获取 Cookies

1. 在程序中选择“使用账号密码（推荐）”
   - 首次运行任意脚本（`XDUClassVideoDownloader.py` 或 `Automation.py`）时，会出现认证方式选择：
     - 使用账号密码（推荐，自动获取最新 cookies）
     - 手动输入 cookies
2. 按提示输入您的超星账号和密码（不是西电统一认证账号密码）
   - 程序会自动完成必要的登录流程，并从登录会话中提取所需的三个 Cookie 值
3. 选择是否保存认证信息
   - 选择“是”将把必要信息写入 `auth.ini`
   - 您也可以选择不保存，下次运行再输入

注意：账号密码仅用于向超星官方登录接口发起认证以换取 Cookie；程序不会上传您的凭证到第三方。

### 方式二：手动获取并输入 Cookies

步骤 / Steps:

1. **打开浏览器并登录**

   - 访问 <https://passport2.chaoxing.com/login>，使用您的超星账号登录
   - 或者访问 <https://learning.xidian.edu.cn>，使用您的学校账号登录

2. **打开录直播平台**

   - 访问 <https://i.mooc.chaoxing.com/>

3. **打开 Cookies 菜单**

   - 方法一：
     - 点击浏览器地址栏左侧的锁形图标
     - 选择 "Cookies" 选项
     - 展开 `chaoxing.com` 域名，下面会显示该域名下的所有 Cookies
   - 方法二：
     - 使用快捷键 `F12` 打开开发者工具
     - 切换到 "应用程序（Application）" 标签
     - 在左侧找到 "Cookies" 选项，点击左侧小三角展开域名列表
     - 随便点一个域名，右边会显示该域名下的所有 Cookies

4. **复制 Cookie 信息**
   - 在 Cookies 中找到以下三个值：
     - `_d`：一串数字
     - `UID`：一串数字
     - `vc3`：一长串字符，不要勾选 `显示已解码的 URL`

## 使用说明

### 首次运行

1. 运行程序：`python XDUClassVideoDownloader.py` 或 `python Automation.py`
2. 按提示选择认证方式：
   - 1：使用账号密码（推荐）→ 输入账号与密码，程序自动获取 `_d`、`UID`、`vc3`
   - 2：手动输入 cookies → 按顺序输入 `_d`、`UID`、`vc3`
3. 选择是否保存认证信息到 `auth.ini`
   - 选择保存时，程序会把认证信息写入文件
   - 不保存则仅在本次运行内有效，下次需要重新输入

### 后续运行

- 程序会自动读取已保存的认证信息
- 无需再次输入，除非认证信息过期

## 注意事项

1. **保护您的认证信息**

   - 不要与他人分享您的 Cookie 信息
   - `auth.ini` 文件包含敏感信息，请妥善保管；如选择保存账号密码，也会存于此

2. **认证信息过期**

   - Cookie 可能会过期，如果下载失败请重新获取
   - 删除 `auth.ini` 文件可以重新设置认证信息

3. **配置文件**

   - `auth.ini`: 存储认证信息

4. **auth.ini 文件结构（自动维护）**
   - `[SETTINGS]` 段：`auth_method`（`cookies`/`password`），`save_auth_info`（`true`/`false`）
   - 若使用手动 Cookies：`[AUTH]` 段包含 `_d`、`UID`、`vc3`
   - 若使用账号密码：`[CREDENTIALS]` 段包含 `username`、`password`
   - 请不要手动修改文件内容

## 故障排除

### 如果遇到认证错误

1. 确认您已正确登录录播平台
2. 重新获取 Cookie 信息（可能已过期）
3. 删除 `auth.ini` 文件并重新运行程序
4. 确保复制的 Cookie 值完整且正确
5. 如使用账号密码方式，确认账号密码未更改且可正常登录超星平台

### 如果下载失败

1. 检查网络连接
2. 确认课程视频确实存在
3. 尝试重新获取认证信息
4. 检查是否有新的 API 变更
